title: Privilege Denied
description: |
  A legacy application that used to run with special privileges now fails to start.
  Security policies have been enforced, and the deployment needs updating.
theme: rbac-security
difficulty: medium
type: fix
estimatedTime: 20
initialSituation: |
  A legacy application was deployed and worked fine initially.
  After implementing Pod Security Standards at the cluster level, the pod fails to start.
  The error message shows: "Error: container has runAsNonRoot and image will run as root".
  The deployment is configured to run as root, which is now blocked by security policies.
  The pod also writes to the root filesystem, which is not allowed.
objective: |
  Update the deployment's SecurityContext to comply with Pod Security Standards.
  Make the application run as a non-root user and use a read-only root filesystem.

objectives:
  - key: pod-ready-check
    title: "Pod Ready"
    description: "The legacy-app pod must be running and in Ready state"
    order: 1
    type: status
    spec:
      target:
        kind: Pod
        labelSelector:
          app: legacy-app
      conditions:
        - type: Ready
          status: "True"
