title: Access Pending
description: |
  The new deployment went out, the pod is Running, but it never becomes Ready.
  The startup probe keeps failing with a mysterious "Forbidden" error.
theme: rbac-security
difficulty: hard
type: fix
estimatedTime: 15
initialSituation: |
  A new application was deployed that needs to query the Kubernetes API during startup.
  The pod status shows Running, but the Ready condition stays False.
  kubectl describe pod shows the startup probe is failing repeatedly.
  Looking at the logs, you see: "Error querying API: forbidden - User cannot list pods".
  The application uses a ServiceAccount, but something about the permissions is wrong.
objective: |
  Investigate why the application can't access the Kubernetes API.
  Fix the configuration so the startup probe passes and the pod becomes Ready.

objectives:
  - key: pod-ready-check
    title: "Pod Ready"
    description: "The startup-app pod must be running and in Ready state"
    order: 1
    type: condition
    spec:
      target:
        kind: Pod
        labelSelector:
          app: startup-app
      checks:
        - type: Ready
          status: "True"

  - key: pod-logs-check
    title: "Application Logs Check"
    description: "The startup-app must output 'Access OK' indicating successful API access"
    order: 2
    type: log
    spec:
      target:
        kind: Pod
        labelSelector:
          app: startup-app
      container: startup-app
      expectedStrings:
        - "Access OK"
      sinceSeconds: 120
